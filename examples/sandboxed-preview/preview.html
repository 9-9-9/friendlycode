<!DOCTYPE html>
<meta charset="utf-8">
<style>
body, html, iframe {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  border: none;
  font-size: 0;
}
</style>
<title>Live Preview Sandbox</title>
<script src="../../js/require-config.js"></script>
<script src="../../vendor/require.min.js"></script>
<script>
define("main", function(require) {
  var $ = require("jquery"),
      LivePreview = require("fc/ui/live-preview"),
      Channel = require("jschannel"),
      channelToEditor = Channel.build({
        window: window.parent,
        origin: "*",
        scope: "friendlycode"
      });

  var initWithPlugins = function(plugins) {
    var preview = LivePreview({
      channelToEditor: channelToEditor,
      ignoreErrors: true,
      previewArea: $(document.body),
      plugins: plugins
    });

    preview.on("change:title", function(title) {
      channelToEditor.notify({method: "change:title", params: title});
    });

    channelToEditor.bind("setHTML", function(trans, params) {
      preview.onReparse({
        error: params.error,
        document: null,
        sourceCode: params.sourceCode
      });
    });
  };
  
  channelToEditor.bind("init", function(trans, options) {
    trans.delayReturn(true);
    require(options.plugins, function() {
      try {
        initWithPlugins([].slice.call(arguments));
      } catch (e) {
        trans.error("init_fail", e.toString());
        throw e;
      }
      trans.complete("success");
    });
  });
});
  
require(["main"], function() {});
</script>
